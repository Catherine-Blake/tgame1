<!DOCTYPE html>
<html>
<head>
    <title>TON Tap Empire</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
            color: white;
            min-height: 100vh;
            padding: 0;
            overflow-x: hidden;
        }
        
        .container {
            width: 100%;
            min-height: 100vh;
            padding: 15px;
            display: flex;
            flex-direction: column;
        }

        /* –ù–ê–í–ò–ì–ê–¶–ò–Ø */
        .nav-tabs {
            display: flex;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 15px;
            backdrop-filter: blur(10px);
        }

        .nav-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            font-weight: 500;
        }

        .nav-tab.active {
            background: rgba(255,255,255,0.2);
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        /* –°–ò–°–¢–ï–ú–ê –†–ê–ù–ì–û–í - –í–ò–ó–£–ê–õ–¨–ù–´–ï –≠–§–§–ï–ö–¢–´ */
        .rank-bronze { color: #CD7F32; text-shadow: 0 0 10px rgba(205, 127, 50, 0.5); }
        .rank-silver { color: #C0C0C0; text-shadow: 0 0 15px rgba(192, 192, 192, 0.6); }
        .rank-gold { 
            color: #FFD700; 
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.7);
            background: linear-gradient(45deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: goldShine 3s infinite;
        }
        .rank-platinum { 
            color: #E5E4E2;
            text-shadow: 0 0 25px rgba(229, 228, 226, 0.8);
            background: linear-gradient(45deg, #E5E4E2, #B0B0B0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .rank-diamond {
            color: #B9F2FF;
            text-shadow: 0 0 30px rgba(185, 242, 255, 0.9);
            background: linear-gradient(45deg, #B9F2FF, #667eea);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: diamondSparkle 4s infinite;
        }

        @keyframes goldShine {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.3); }
        }

        @keyframes diamondSparkle {
            0%, 100% { filter: hue-rotate(0deg); }
            50% { filter: hue-rotate(45deg); }
        }

        .rank-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 8px;
        }

        .badge-bronze { background: linear-gradient(45deg, #CD7F32, #8B6914); }
        .badge-silver { background: linear-gradient(45deg, #C0C0C0, #A0A0A0); }
        .badge-gold { background: linear-gradient(45deg, #FFD700, #FF8C00); }
        .badge-platinum { background: linear-gradient(45deg, #E5E4E2, #C0C0C0); }
        .badge-diamond { 
            background: linear-gradient(45deg, #B9F2FF, #667eea);
            animation: badgeGlow 2s infinite;
        }

        @keyframes badgeGlow {
            0%, 100% { box-shadow: 0 0 10px rgba(185, 242, 255, 0.5); }
            50% { box-shadow: 0 0 20px rgba(185, 242, 255, 0.8); }
        }

        /* Header —Å –ø—Ä–æ–≥—Ä–µ—Å—Å –±–∞—Ä–æ–º */
        .header {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 20px;
            margin-bottom: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            position: relative;
        }
        
        .player-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .player-rank {
            font-size: 14px;
            font-weight: bold;
        }

        .level-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .progress-bar {
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #ffd93d, #ff6b6b);
            border-radius: 4px;
            transition: width 0.3s;
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        /* –û–°–ù–û–í–ù–û–ô –≠–õ–ï–ú–ï–ù–¢ */
        .tap-area {
            text-align: center;
            margin: 25px 0;
            position: relative;
            perspective: 1000px;
        }
        
        .ton-coin {
            width: 180px;
            height: 180px;
            margin: 0 auto;
            position: relative;
            cursor: pointer;
            transform-style: preserve-3d;
            transition: all 0.3s ease;
        }
        
        .coin-front, .coin-back {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: bold;
            transition: all 0.5s ease;
        }
        
        .coin-front {
            background: radial-gradient(circle at 30% 30%, #ffd93d, #ff9a00);
            border: 8px solid #ff9a00;
            box-shadow: 0 0 30px rgba(255, 217, 61, 0.6);
        }
        
        .coin-back {
            background: radial-gradient(circle at 30% 30%, #0088cc, #005599);
            border: 8px solid #005599;
            transform: rotateY(180deg);
        }
        
        .ton-coin:active {
            transform: scale(0.95) rotateY(10deg);
        }
        
        .coin-pulse {
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            border: 2px solid #ffd93d;
            border-radius: 50%;
            animation: pulse 2s infinite;
            pointer-events: none;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.1); opacity: 0; }
        }
        
        /* –≠–§–§–ï–ö–¢–´ –¢–ê–ü–ê */
        .tap-effect {
            position: absolute;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            animation: floatUp 1s forwards;
            pointer-events: none;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        
        .tap-effect.normal {
            background: radial-gradient(circle, #ffd93d, transparent);
            color: #ff9a00;
        }
        
        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-80px) scale(0); opacity: 0; }
        }

        /* –°–¢–ê–¢–ò–°–¢–ò–ö–ê */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.1);
            padding: 12px;
            border-radius: 12px;
            text-align: center;
            font-size: 14px;
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
        }
        
        .stat-value {
            font-size: 18px;
            font-weight: bold;
            margin-top: 4px;
        }

        /* –õ–ò–î–ï–†–ë–û–†–î */
        .leaderboard-container {
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            max-height: 400px;
            overflow-y: auto;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            transition: transform 0.2s;
        }

        .leaderboard-item:hover {
            transform: translateX(5px);
            background: rgba(255,255,255,0.1);
        }

        .leaderboard-rank {
            width: 30px;
            text-align: center;
            font-weight: bold;
            font-size: 16px;
        }

        .leaderboard-player {
            flex: 1;
            margin-left: 10px;
        }

        .leaderboard-score {
            font-weight: bold;
            color: #ffd93d;
        }

        .rank-1 { background: linear-gradient(45deg, rgba(255,215,0,0.2), rgba(255,165,0,0.2)); }
        .rank-2 { background: linear-gradient(45deg, rgba(192,192,192,0.2), rgba(160,160,160,0.2)); }
        .rank-3 { background: linear-gradient(45deg, rgba(205,127,50,0.2), rgba(139,105,20,0.2)); }

        /* –ü–†–û–§–ò–õ–¨ */
        .profile-container {
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .profile-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .profile-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .profile-stat {
            background: rgba(255,255,255,0.05);
            padding: 10px;
            border-radius: 10px;
            text-align: center;
        }

        .beta-notice {
            background: linear-gradient(45deg, #667eea, #764ba2);
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            margin-top: 15px;
            font-size: 12px;
        }

        /* –£–ª—É—á—à–µ–Ω–∏—è */
        .upgrades-section {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .upgrade-item {
            background: rgba(255,255,255,0.15);
            padding: 15px;
            border-radius: 12px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.2s;
        }
        
        .upgrade-item:hover {
            transform: translateX(5px);
        }
        
        .upgrade-info {
            flex: 1;
        }
        
        .upgrade-name {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 4px;
        }
        
        .upgrade-desc {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .upgrade-btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            min-width: 80px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .upgrade-btn:disabled {
            background: #666;
            cursor: not-allowed;
            box-shadow: none;
        }

        /* –°–∫—Ä—ã—Ç—ã–µ —Å–µ–∫—Ü–∏–∏ */
        .section {
            display: none;
        }

        .section.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –ù–ê–í–ò–ì–ê–¶–ò–Ø -->
        <div class="nav-tabs">
            <div class="nav-tab active" onclick="showSection('game')">üéÆ –ò–≥—Ä–∞</div>
            <div class="nav-tab" onclick="showSection('leaderboard')">üèÜ –¢–æ–ø-50</div>
            <div class="nav-tab" onclick="showSection('profile')">üë§ –ü—Ä–æ—Ñ–∏–ª—å</div>
        </div>

        <!-- –°–ï–ö–¶–ò–Ø –ò–ì–†–´ -->
        <div id="game-section" class="section active">
            <!-- –•–µ–¥–µ—Ä —Å —É—Ä–æ–≤–Ω–µ–º -->
            <div class="header">
                <div class="player-info">
                    <div class="player-rank" id="player-rank">ü•â –ë–†–û–ù–ó–ê</div>
                    <div>üíé <span id="coins">0</span></div>
                </div>
                <div class="level-info">
                    <span>‚≠ê –£—Ä–æ–≤–µ–Ω—å <span id="level">1</span></span>
                    <span id="rank-progress">0/1000</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="level-progress" style="width: 0%"></div>
                </div>
            </div>
            
            <!-- –û–°–ù–û–í–ù–û–ô –≠–õ–ï–ú–ï–ù–¢ -->
            <div class="tap-area">
                <div class="ton-coin" id="coin-button">
                    <div class="coin-front">TON</div>
                    <div class="coin-back">üí∞</div>
                    <div class="coin-pulse"></div>
                </div>
            </div>
            
            <!-- –°–¢–ê–¢–ò–°–¢–ò–ö–ê -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div>‚ö° –°–∏–ª–∞ —Ç–∞–ø–∞</div>
                    <div class="stat-value" id="tap-power">1</div>
                </div>
                <div class="stat-card">
                    <div>üëÜ –í—Å–µ–≥–æ —Ç–∞–ø–æ–≤</div>
                    <div class="stat-value" id="total-taps">0</div>
                </div>
                <div class="stat-card">
                    <div>ü§ñ –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä—ã</div>
                    <div class="stat-value" id="auto-clickers">0</div>
                </div>
                <div class="stat-card">
                    <div>üí∞ –í —Å–µ–∫—É–Ω–¥—É</div>
                    <div class="stat-value" id="income-per-second">0</div>
                </div>
            </div>
            
            <!-- –£–ª—É—á—à–µ–Ω–∏—è -->
            <div class="upgrades-section">
                <h3 style="margin-bottom: 15px; text-align: center;">üõ† –£–ª—É—á—à–µ–Ω–∏—è</h3>
                <div class="upgrade-item">
                    <div class="upgrade-info">
                        <div class="upgrade-name">üí™ –£—Å–∏–ª–∏—Ç–µ–ª—å —Ç–∞–ø–∞</div>
                        <div class="upgrade-desc">+1 –∫ —Å–∏–ª–µ –∑–∞ –∫–ª–∏–∫</div>
                    </div>
                    <button class="upgrade-btn" id="upgrade-tap" data-cost="50">50 üíé</button>
                </div>
                <div class="upgrade-item">
                    <div class="upgrade-info">
                        <div class="upgrade-name">‚ö° –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä</div>
                        <div class="upgrade-desc">+1 –º–æ–Ω–µ—Ç–∞ –≤ —Å–µ–∫—É–Ω–¥—É</div>
                    </div>
                    <button class="upgrade-btn" id="upgrade-auto" data-cost="100">100 üíé</button>
                </div>
                <div class="upgrade-item">
                    <div class="upgrade-info">
                        <div class="upgrade-name">üéØ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É–¥–∞—Ä</div>
                        <div class="upgrade-desc">–®–∞–Ω—Å x3 —É—Ä–æ–Ω–∞</div>
                    </div>
                    <button class="upgrade-btn" id="upgrade-crit" data-cost="200">200 üíé</button>
                </div>
            </div>

            <!-- –ë–ï–¢–ê-–£–í–ï–î–û–ú–õ–ï–ù–ò–ï -->
            <div class="beta-notice">
                <strong>üéÆ –ë–ï–¢–ê-–í–ï–†–°–ò–Ø</strong><br>
                –í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞ —ç—Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.<br>
                –°–∫–æ—Ä–æ: –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è!
            </div>
        </div>

        <!-- –°–ï–ö–¶–ò–Ø –õ–ò–î–ï–†–ë–û–†–î–ê -->
        <div id="leaderboard-section" class="section">
            <div class="leaderboard-container">
                <h3 style="text-align: center; margin-bottom: 15px;">üèÜ –¢–û–ü-50 –ò–ì–†–û–ö–û–í</h3>
                <div id="leaderboard-list">
                    <!-- –õ–∏–¥–µ—Ä–±–æ—Ä–¥ –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>

        <!-- –°–ï–ö–¶–ò–Ø –ü–†–û–§–ò–õ–Ø -->
        <div id="profile-section" class="section">
            <div class="profile-container">
                <div class="profile-header">
                    <h3 id="profile-name">üë§ –ò–≥—Ä–æ–∫</h3>
                    <div class="player-rank" id="profile-rank">ü•â –ë–†–û–ù–ó–ê</div>
                </div>
                
                <div class="profile-stats">
                    <div class="profile-stat">
                        <div>üëÜ –í—Å–µ–≥–æ —Ç–∞–ø–æ–≤</div>
                        <div class="stat-value" id="profile-taps">0</div>
                    </div>
                    <div class="profile-stat">
                        <div>‚≠ê –£—Ä–æ–≤–µ–Ω—å</div>
                        <div class="stat-value" id="profile-level">1</div>
                    </div>
                    <div class="profile-stat">
                        <div>‚ö° –°–∏–ª–∞ —Ç–∞–ø–∞</div>
                        <div class="stat-value" id="profile-power">1</div>
                    </div>
                    <div class="profile-stat">
                        <div>ü§ñ –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä—ã</div>
                        <div class="stat-value" id="profile-autoclickers">0</div>
                    </div>
                    <div class="profile-stat">
                        <div>üéØ –ö—Ä–∏—Ç. —à–∞–Ω—Å</div>
                        <div class="stat-value" id="profile-crit">0%</div>
                    </div>
                    <div class="profile-stat">
                        <div>üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</div>
                        <div class="stat-value" id="profile-achievements">0</div>
                    </div>
                </div>

                <div class="beta-notice">
                    <strong>üíé –°–¢–ê–¢–£–° –û–°–ù–û–í–ê–¢–ï–õ–Ø</strong><br>
                    –í—ã —Å—Ä–µ–¥–∏ –ø–µ—Ä–≤—ã—Ö –∏–≥—Ä–æ–∫–æ–≤ TON Tap Empire!<br>
                    –í–∞—à–µ –∏–º—è –≤–æ–π–¥–µ—Ç –≤ –∏—Å—Ç–æ—Ä–∏—é –∏–≥—Ä—ã!
                </div>
            </div>
        </div>
    </div>

    <script>
        // –°–ò–°–¢–ï–ú–ê –†–ê–ù–ì–û–í
        const rankSystem = {
            BRONZE: { 
                minScore: 0, 
                color: "#CD7F32", 
                badge: "ü•â",
                name: "–ë–†–û–ù–ó–ê",
                class: "rank-bronze",
                badgeClass: "badge-bronze"
            },
            SILVER: { 
                minScore: 1000, 
                color: "#C0C0C0", 
                badge: "ü•à", 
                name: "–°–ï–†–ï–ë–†–û",
                class: "rank-silver", 
                badgeClass: "badge-silver"
            },
            GOLD: { 
                minScore: 5000, 
                color: "#FFD700", 
                badge: "ü•á", 
                name: "–ó–û–õ–û–¢–û",
                class: "rank-gold",
                badgeClass: "badge-gold"
            },
            PLATINUM: { 
                minScore: 20000, 
                color: "#E5E4E2", 
                badge: "üí†", 
                name: "–ü–õ–ê–¢–ò–ù–ê",
                class: "rank-platinum",
                badgeClass: "badge-platinum"
            },
            DIAMOND: { 
                minScore: 50000, 
                color: "#B9F2FF", 
                badge: "üíé", 
                name: "–ê–õ–ú–ê–ó",
                class: "rank-diamond",
                badgeClass: "badge-diamond"
            }
        };

        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let coins = 0;
        let tapPower = 1;
        let totalTaps = 0;
        let passiveIncome = 0;
        let level = 1;
        let levelProgress = 0;
        let autoClickers = 0;
        let critChance = 0;
        let currentRank = 'BRONZE';
        
        // –õ–ò–î–ï–†–ë–û–†–î (–ª–æ–∫–∞–ª—å–Ω—ã–π –¥–µ–º–æ)
        let leaderboard = [];
        const MAX_LEADERBOARD_SIZE = 50;

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram
        let tg = window.Telegram.WebApp;
        
        function initGame() {
            tg.expand();
            tg.ready();
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            const user = tg.initDataUnsafe.user;
            if (user) {
                loadProgress(user.id);
                initializeLeaderboard(user.id, user.first_name || '–ò–≥—Ä–æ–∫');
            } else {
                initializeLeaderboard('demo_user', '–î–µ–º–æ-–ò–≥—Ä–æ–∫');
            }
            
            setupEventListeners();
            startPassiveIncome();
            startCoinAnimation();
            updateUI();
            updateRank();
        }
        
        function setupEventListeners() {
            // –û—Å–Ω–æ–≤–Ω–æ–π —Ç–∞–ø –ø–æ –º–æ–Ω–µ—Ç–µ
            document.getElementById('coin-button').addEventListener('click', handleTap);
            
            // –£–ª—É—á—à–µ–Ω–∏—è
            document.getElementById('upgrade-tap').addEventListener('click', () => buyUpgrade('tap'));
            document.getElementById('upgrade-auto').addEventListener('click', () => buyUpgrade('auto'));
            document.getElementById('upgrade-crit').addEventListener('click', () => buyUpgrade('crit'));
        }

        function handleTap(event) {
            // –í—Ä–∞—â–∞–µ–º –º–æ–Ω–µ—Ç—É
            const coinRotation = Date.now() % 360;
            document.getElementById('coin-button').style.transform = `rotateY(${coinRotation}deg)`;
            
            // –†–∞—Å—á–µ—Ç —É—Ä–æ–Ω–∞
            let earned = tapPower;
            if (Math.random() < critChance) {
                earned *= 3; // –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É–¥–∞—Ä
            }
            
            coins += earned;
            totalTaps++;
            levelProgress += earned;
            
            // –°–æ–∑–¥–∞–µ–º —ç—Ñ—Ñ–µ–∫—Ç
            createTapEffect(event, earned);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
            updateUI();
            updateRank();
            updateLeaderboard();
            saveProgress();
        }
        
        function createTapEffect(event, amount) {
            const effect = document.createElement('div');
            effect.className = 'tap-effect normal';
            effect.textContent = '+' + amount;
            effect.style.left = (event.clientX - 20) + 'px';
            effect.style.top = (event.clientY - 20) + 'px';
            document.querySelector('.tap-area').appendChild(effect);
            
            setTimeout(() => effect.remove(), 1000);
        }
        
        function startCoinAnimation() {
            setInterval(() => {
                const coin = document.getElementById('coin-button');
                coin.style.transform = 'scale(1.03)';
                setTimeout(() => {
                    coin.style.transform = 'scale(1)';
                }, 300);
            }, 3000);
        }
        
        function buyUpgrade(type) {
            const button = document.getElementById(`upgrade-${type}`);
            const cost = parseInt(button.dataset.cost);
            
            if (coins >= cost) {
                coins -= cost;
                
                switch(type) {
                    case 'tap':
                        tapPower += 1;
                        button.dataset.cost = Math.floor(cost * 1.5);
                        button.textContent = Math.floor(cost * 1.5) + ' üíé';
                        break;
                    case 'auto':
                        passiveIncome += 1;
                        autoClickers += 1;
                        button.dataset.cost = Math.floor(cost * 2);
                        button.textContent = Math.floor(cost * 2) + ' üíé';
                        break;
                    case 'crit':
                        critChance += 0.05;
                        button.dataset.cost = Math.floor(cost * 3);
                        button.textContent = Math.floor(cost * 3) + ' üíé';
                        break;
                }
                
                updateUI();
                updateRank();
                saveProgress();
            }
        }

        // –°–ò–°–¢–ï–ú–ê –†–ê–ù–ì–û–í
        function calculateRankScore() {
            // –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥–∞
            return totalTaps + (level * 100) + (autoClickers * 50) + (tapPower * 10) + (critChance * 1000);
        }

        function updateRank() {
            const score = calculateRankScore();
            let newRank = 'BRONZE';
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–∞–Ω–≥ –ø–æ score
            for (const [rank, data] of Object.entries(rankSystem)) {
                if (score >= data.minScore) {
                    newRank = rank;
                }
            }
            
            if (newRank !== currentRank) {
                currentRank = newRank;
                // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é —Å–º–µ–Ω—ã —Ä–∞–Ω–≥–∞
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–∞–Ω–≥–∞
            const rankData = rankSystem[currentRank];
            const rankElement = document.getElementById('player-rank');
            rankElement.innerHTML = `${rankData.badge} <span class="${rankData.class}">${rankData.name}</span>`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ä–∞–Ω–≥–∞
            const nextRank = getNextRank(currentRank);
            if (nextRank) {
                const progress = ((score - rankData.minScore) / (nextRank.minScore - rankData.minScore)) * 100;
                document.getElementById('rank-progress').textContent = 
                    `${score - rankData.minScore}/${nextRank.minScore - rankData.minScore}`;
            } else {
                document.getElementById('rank-progress').textContent = '–ú–ê–ö–°–ò–ú–£–ú';
            }
        }

        function getNextRank(currentRank) {
            const ranks = Object.keys(rankSystem);
            const currentIndex = ranks.indexOf(currentRank);
            return currentIndex < ranks.length - 1 ? rankSystem[ranks[currentIndex + 1]] : null;
        }

        // –õ–ò–î–ï–†–ë–û–†–î
        function initializeLeaderboard(userId, userName) {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ª–∏–¥–µ—Ä–±–æ—Ä–¥ –∏–ª–∏ —Å–æ–∑–¥–∞–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ
            const savedLeaderboard = localStorage.getItem('ton_tap_leaderboard');
            if (savedLeaderboard) {
                leaderboard = JSON.parse(savedLeaderboard);
            } else {
                // –°–æ–∑–¥–∞–µ–º –¥–µ–º–æ-–ª–∏–¥–µ—Ä–±–æ—Ä–¥
                leaderboard = generateDemoLeaderboard();
                leaderboard.push({
                    id: userId,
                    name: userName,
                    score: calculateRankScore(),
                    rank: currentRank
                });
                updateLeaderboard();
            }
        }

        function generateDemoLeaderboard() {
            const demoPlayers = [];
            const names = ['Alex', 'Maria', 'John', 'Anna', 'Mike', 'Sarah', 'David', 'Emma', 'James', 'Lisa'];
            
            for (let i = 0; i < 49; i++) {
                demoPlayers.push({
                    id: 'demo_' + i,
                    name: names[i % names.length] + (Math.floor(i / names.length) + 1),
                    score: Math.floor(Math.random() * 100000) + 1000,
                    rank: Object.keys(rankSystem)[Math.floor(Math.random() * Object.keys(rankSystem).length)]
                });
            }
            
            return demoPlayers.sort((a, b) => b.score - a.score).slice(0, MAX_LEADERBOARD_SIZE - 1);
        }

        function updateLeaderboard() {
            const user = tg.initDataUnsafe.user;
            if (!user) return;

            // –û–±–Ω–æ–≤–ª—è–µ–º score —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
            const userScore = calculateRankScore();
            const userIndex = leaderboard.findIndex(p => p.id === user.id);
            
            if (userIndex !== -1) {
                leaderboard[userIndex].score = userScore;
                leaderboard[userIndex].rank = currentRank;
            } else {
                leaderboard.push({
                    id: user.id,
                    name: user.first_name || '–ò–≥—Ä–æ–∫',
                    score: userScore,
                    rank: currentRank
                });
            }
            
            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –∏ –æ–±—Ä–µ–∑–∞–µ–º –ª–∏–¥–µ—Ä–±–æ—Ä–¥
            leaderboard.sort((a, b) => b.score - a.score);
            leaderboard = leaderboard.slice(0, MAX_LEADERBOARD_SIZE);
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º
            localStorage.setItem('ton_tap_leaderboard', JSON.stringify(leaderboard));
            renderLeaderboard();
        }

        function renderLeaderboard() {
            const list = document.getElementById('leaderboard-list');
            list.innerHTML = '';
            
            leaderboard.forEach((player, index) => {
                const rankData = rankSystem[player.rank] || rankSystem.BRONZE;
                const item = document.createElement('div');
                item.className = `leaderboard-item ${index < 3 ? 'rank-' + (index + 1) : ''}`;
                item.innerHTML = `
                    <div class="leaderboard-rank">${index + 1}</div>
                    <div class="leaderboard-player">
                        <span class="${rankData.class}">${player.name}</span>
                        <div class="rank-badge ${rankData.badgeClass}">${rankData.badge} ${rankData.name}</div>
                    </div>
                    <div class="leaderboard-score">${player.score.toLocaleString()}</div>
                `;
                list.appendChild(item);
            });
        }

        // –ù–ê–í–ò–ì–ê–¶–ò–Ø
        function showSection(sectionName) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–µ–∫—Ü–∏–∏
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é —Å–µ–∫—Ü–∏—é
            document.getElementById(sectionName + '-section').classList.add('active');
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –Ω—É–∂–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            event.target.classList.add('active');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ —Å–µ–∫—Ü–∏—è—Ö
            if (sectionName === 'profile') {
                updateProfile();
            } else if (sectionName === 'leaderboard') {
                renderLeaderboard();
            }
        }

        function updateProfile() {
            const user = tg.initDataUnsafe.user;
            if (user) {
                document.getElementById('profile-name').textContent = `üë§ ${user.first_name || '–ò–≥—Ä–æ–∫'}`;
            }
            
            const rankData = rankSystem[currentRank];
            document.getElementById('profile-rank').innerHTML = 
                `${rankData.badge} <span class="${rankData.class}">${rankData.name}</span>`;
            
            document.getElementById('profile-taps').textContent = totalTaps.toLocaleString();
            document.getElementById('profile-level').textContent = level;
            document.getElementById('profile-power').textContent = tapPower;
            document.getElementById('profile-autoclickers').textContent = autoClickers;
            document.getElementById('profile-crit').textContent = Math.round(critChance * 100) + '%';
        }

        // –ü–ê–°–°–ò–í–ù–´–ô –î–û–•–û–î
        function startPassiveIncome() {
            setInterval(() => {
                if (passiveIncome > 0) {
                    coins += passiveIncome;
                    updateUI();
                    updateLeaderboard();
                    saveProgress();
                }
            }, 1000);
        }
        
        function updateUI() {
            document.getElementById('coins').textContent = coins;
            document.getElementById('tap-power').textContent = tapPower;
            document.getElementById('total-taps').textContent = totalTaps.toLocaleString();
            document.getElementById('auto-clickers').textContent = autoClickers;
            document.getElementById('income-per-second').textContent = passiveIncome;
            document.getElementById('level').textContent = level;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ —É–ª—É—á—à–µ–Ω–∏–π
            updateUpgradeButtons();
        }
        
        function updateUpgradeButtons() {
            const upgrades = ['tap', 'auto', 'crit'];
            upgrades.forEach(type => {
                const button = document.getElementById(`upgrade-${type}`);
                const cost = parseInt(button.dataset.cost);
                button.disabled = coins < cost;
            });
        }
        
        function loadProgress(userId) {
            try {
                const saved = localStorage.getItem(`ton_tap_player_${userId}`);
                if (saved) {
                    const data = JSON.parse(saved);
                    coins = data.coins || 0;
                    tapPower = data.tapPower || 1;
                    totalTaps = data.totalTaps || 0;
                    passiveIncome = data.passiveIncome || 0;
                    autoClickers = data.autoClickers || 0;
                    level = data.level || 1;
                    levelProgress = data.levelProgress || 0;
                    critChance = data.critChance || 0;
                }
            } catch (e) {
                console.error('Error loading progress:', e);
            }
        }
        
        function saveProgress() {
            try {
                const user = tg.initDataUnsafe.user;
                if (user) {
                    const data = {
                        coins,
                        tapPower,
                        totalTaps,
                        passiveIncome,
                        autoClickers,
                        level,
                        levelProgress,
                        critChance
                    };
                    localStorage.setItem(`ton_tap_player_${user.id}`, JSON.stringify(data));
                }
            } catch (e) {
                console.error('Error saving progress:', e);
            }
        }
        
        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
