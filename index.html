<!DOCTYPE html>
<html>
<head>
    <title>TON Tap Empire</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
            color: white;
            min-height: 100vh;
            padding: 0;
            overflow-x: hidden;
        }
        
        .container {
            width: 100%;
            min-height: 100vh;
            padding: 15px;
            display: flex;
            flex-direction: column;
        }

        /* –ù–ê–í–ò–ì–ê–¶–ò–Ø */
        .nav-tabs {
            display: flex;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 15px;
            backdrop-filter: blur(10px);
        }

        .nav-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            font-weight: 500;
        }

        .nav-tab.active {
            background: rgba(255,255,255,0.2);
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        /* TON-–ü–ï–†–°–û–ù–ê–ñ */
        .character-container {
            text-align: center;
            margin: 20px 0;
            position: relative;
        }

        .ton-character {
            width: 160px;
            height: 160px;
            margin: 0 auto;
            position: relative;
            cursor: pointer;
            transition: all 0.1s;
        }

        .character-body {
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 30% 30%, #0088cc, #005599);
            border-radius: 35% 65% 60% 40% / 40% 45% 55% 60%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            box-shadow: 
                0 0 40px rgba(0, 136, 204, 0.6),
                inset 0 0 20px rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
        }

        .character-face {
            position: absolute;
            font-size: 24px;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .character-glow {
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            border: 3px solid #0088cc;
            border-radius: 50%;
            animation: characterPulse 2s infinite;
            pointer-events: none;
        }

        @keyframes characterPulse {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(1.1); opacity: 0; }
        }

        .ton-character:active {
            transform: scale(0.95);
        }

        /* –≠–í–û–õ–Æ–¶–ò–Ø –ü–ï–†–°–û–ù–ê–ñ–ê */
        .character-level-1 .character-body { background: radial-gradient(circle at 30% 30%, #0088cc, #005599); }
        .character-level-10 .character-body { 
            background: radial-gradient(circle at 30% 30%, #4CAF50, #2E7D32);
            box-shadow: 0 0 50px rgba(76, 175, 80, 0.7);
        }
        .character-level-20 .character-body { 
            background: radial-gradient(circle at 30% 30%, #FFD700, #FF8C00);
            box-shadow: 0 0 60px rgba(255, 215, 0, 0.8);
        }
        .character-level-30 .character-body { 
            background: radial-gradient(circle at 30% 30%, #B9F2FF, #667eea);
            box-shadow: 0 0 70px rgba(185, 242, 255, 0.9);
            animation: dragonGlow 3s infinite;
        }

        @keyframes dragonGlow {
            0%, 100% { filter: hue-rotate(0deg); }
            50% { filter: hue-rotate(45deg); }
        }

        /* –°–ò–°–¢–ï–ú–ê –†–ê–ù–ì–û–í */
        .rank-bronze { color: #CD7F32; text-shadow: 0 0 10px rgba(205, 127, 50, 0.5); }
        .rank-silver { color: #C0C0C0; text-shadow: 0 0 15px rgba(192, 192, 192, 0.6); }
        .rank-gold { 
            color: #FFD700; 
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.7);
            background: linear-gradient(45deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: goldShine 3s infinite;
        }
        .rank-platinum { 
            color: #E5E4E2;
            text-shadow: 0 0 25px rgba(229, 228, 226, 0.8);
            background: linear-gradient(45deg, #E5E4E2, #B0B0B0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .rank-diamond {
            color: #B9F2FF;
            text-shadow: 0 0 30px rgba(185, 242, 255, 0.9);
            background: linear-gradient(45deg, #B9F2FF, #667eea);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: diamondSparkle 4s infinite;
        }

        @keyframes goldShine {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.3); }
        }

        @keyframes diamondSparkle {
            0%, 100% { filter: hue-rotate(0deg); }
            50% { filter: hue-rotate(45deg); }
        }

        .rank-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 8px;
        }

        .badge-bronze { background: linear-gradient(45deg, #CD7F32, #8B6914); }
        .badge-silver { background: linear-gradient(45deg, #C0C0C0, #A0A0A0); }
        .badge-gold { background: linear-gradient(45deg, #FFD700, #FF8C00); }
        .badge-platinum { background: linear-gradient(45deg, #E5E4E2, #C0C0C0); }
        .badge-diamond { 
            background: linear-gradient(45deg, #B9F2FF, #667eea);
            animation: badgeGlow 2s infinite;
        }

        @keyframes badgeGlow {
            0%, 100% { box-shadow: 0 0 10px rgba(185, 242, 255, 0.5); }
            50% { box-shadow: 0 0 20px rgba(185, 242, 255, 0.8); }
        }

        /* Header */
        .header {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 20px;
            margin-bottom: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            position: relative;
        }
        
        .player-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .player-rank {
            font-size: 14px;
            font-weight: bold;
        }

        .level-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .progress-bar {
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #ffd93d, #ff6b6b);
            border-radius: 4px;
            transition: width 0.3s;
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        /* –ö–û–ú–ë–û-–°–ò–°–¢–ï–ú–ê */
        .combo-display {
            position: absolute;
            top: -25px;
            right: 10px;
            background: linear-gradient(135deg, #ff6b6b, #ffd93d);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            display: none;
        }

        /* –≠–§–§–ï–ö–¢–´ –¢–ê–ü–ê */
        .tap-effect {
            position: absolute;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            animation: floatUp 1s forwards;
            pointer-events: none;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            z-index: 100;
        }
        
        .tap-effect.normal {
            background: radial-gradient(circle, #ffd93d, transparent);
            color: #ff9a00;
        }
        
        .tap-effect.critical {
            background: radial-gradient(circle, #ff6b6b, transparent);
            color: #ff0000;
            font-size: 18px;
            animation: criticalFloat 1s forwards;
        }
        
        .tap-effect.combo {
            background: radial-gradient(circle, #4CAF50, transparent);
            color: #00ff00;
            animation: comboFloat 1s forwards;
        }
        
        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-80px) scale(0); opacity: 0; }
        }
        
        @keyframes criticalFloat {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            50% { transform: translateY(-40px) scale(1.5); opacity: 1; }
            100% { transform: translateY(-80px) scale(0); opacity: 0; }
        }
        
        @keyframes comboFloat {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-120px) scale(1.2); opacity: 0; }
        }

        /* –°–õ–£–ß–ê–ô–ù–´–ï –ò–í–ï–ù–¢–´ */
        .event-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 20px;
            border-radius: 20px;
            text-align: center;
            z-index: 1000;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            display: none;
        }

        /* –°–¢–ê–¢–ò–°–¢–ò–ö–ê */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.1);
            padding: 12px;
            border-radius: 12px;
            text-align: center;
            font-size: 14px;
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
        }
        
        .stat-value {
            font-size: 18px;
            font-weight: bold;
            margin-top: 4px;
        }

        /* –°–ò–°–¢–ï–ú–ê –ü–†–ò–ì–õ–ê–®–ï–ù–ò–ô */
        .referral-section {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            padding: 20px;
            border-radius: 20px;
            margin-bottom: 15px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .referral-stats {
            display: flex;
            justify-content: space-around;
            margin: 15px 0;
        }

        .referral-stat {
            text-align: center;
        }

        .referral-count {
            font-size: 24px;
            font-weight: bold;
        }

        /* –°–ß–ï–¢–ß–ò–ö –†–ï–ê–õ–¨–ù–´–• –ò–ì–†–û–ö–û–í */
        .player-counter {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 15px;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .counter-progress {
            height: 6px;
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
            margin: 10px 0;
            overflow: hidden;
        }

        .counter-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            border-radius: 3px;
            transition: width 0.5s;
        }

        /* –û–ü–û–í–ï–©–ï–ù–ò–Ø */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255,255,255,0.9);
            color: #333;
            padding: 12px 20px;
            border-radius: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 1000;
            display: none;
            animation: slideDown 0.5s ease-out;
        }

        @keyframes slideDown {
            from { transform: translate(-50%, -100px); opacity: 0; }
            to { transform: translate(-50%, 0); opacity: 1; }
        }

        /* –£–ª—É—á—à–µ–Ω–∏—è */
        .upgrades-section {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 20px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .upgrade-item {
            background: rgba(255,255,255,0.15);
            padding: 15px;
            border-radius: 12px;
            margin: 10px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.2s;
        }
        
        .upgrade-item:hover {
            transform: translateX(5px);
        }
        
        .upgrade-info {
            flex: 1;
        }
        
        .upgrade-name {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 4px;
        }
        
        .upgrade-desc {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .upgrade-btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            min-width: 80px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .upgrade-btn:disabled {
            background: #666;
            cursor: not-allowed;
            box-shadow: none;
        }

        /* –õ–ò–î–ï–†–ë–û–†–î */
        .leaderboard-container {
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            max-height: 400px;
            overflow-y: auto;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            transition: transform 0.2s;
        }

        .leaderboard-item:hover {
            transform: translateX(5px);
            background: rgba(255,255,255,0.1);
        }

        .leaderboard-rank {
            width: 30px;
            text-align: center;
            font-weight: bold;
            font-size: 16px;
        }

        .leaderboard-player {
            flex: 1;
            margin-left: 10px;
        }

        .leaderboard-score {
            font-weight: bold;
            color: #ffd93d;
        }

        .rank-1 { background: linear-gradient(45deg, rgba(255,215,0,0.2), rgba(255,165,0,0.2)); }
        .rank-2 { background: linear-gradient(45deg, rgba(192,192,192,0.2), rgba(160,160,160,0.2)); }
        .rank-3 { background: linear-gradient(45deg, rgba(205,127,50,0.2), rgba(139,105,20,0.2)); }

        /* –ü–†–û–§–ò–õ–¨ */
        .profile-container {
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .profile-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .profile-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .profile-stat {
            background: rgba(255,255,255,0.05);
            padding: 10px;
            border-radius: 10px;
            text-align: center;
        }

        .beta-notice {
            background: linear-gradient(45deg, #667eea, #764ba2);
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            margin-top: 15px;
            font-size: 12px;
        }

        /* –î–ò–ù–ê–ú–ò–ß–ù–´–ô –õ–ò–î–ï–†–ë–û–†–î */
        .user-highlight {
            background: linear-gradient(45deg, rgba(255,215,0,0.1), rgba(255,165,0,0.1)) !important;
            border: 1px solid rgba(255,215,0,0.3) !important;
        }

        .leaderboard-item {
            transition: all 0.3s ease;
        }

        .leaderboard-item:hover {
            transform: translateX(5px) scale(1.02);
            background: rgba(255,255,255,0.15) !important;
        }

        @keyframes scoreUpdate {
            0% { background-color: rgba(76, 175, 80, 0.3); }
            100% { background-color: transparent; }
        }

        .score-update {
            animation: scoreUpdate 1s ease;
        }

        /* –°–∫—Ä—ã—Ç—ã–µ —Å–µ–∫—Ü–∏–∏ */
        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–∞—Å—Å–∏–≤–Ω–æ–≥–æ –¥–æ—Ö–æ–¥–∞ */
        .passive-income-effect {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(76, 175, 80, 0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            animation: slideIn 0.5s ease-out;
            z-index: 1000;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- –û–ü–û–í–ï–©–ï–ù–ò–Ø -->
    <div class="notification" id="notification"></div>

    <!-- –°–õ–£–ß–ê–ô–ù–´–ï –ò–í–ï–ù–¢–´ -->
    <div class="event-notification" id="event-notification">
        <div class="event-title" id="event-title">üéâ –°–ï–ö–†–ï–¢–ù–´–ô –ò–í–ï–ù–¢!</div>
        <div id="event-description">–¢—ã –Ω–∞—à–µ–ª —Å–µ–∫—Ä–µ—Ç–Ω—É—é –º–æ–Ω–µ—Ç—É!</div>
        <button onclick="closeEvent()" style="margin-top: 15px; padding: 10px 20px; background: #ffd93d; border: none; border-radius: 10px; cursor: pointer;">–ö—Ä—É—Ç–æ!</button>
    </div>

    <div class="container">
        <!-- –ù–ê–í–ò–ì–ê–¶–ò–Ø -->
        <div class="nav-tabs">
            <div class="nav-tab active" onclick="showSection('game')">üéÆ –ò–≥—Ä–∞</div>
            <div class="nav-tab" onclick="showSection('leaderboard')">üèÜ –¢–æ–ø-50</div>
            <div class="nav-tab" onclick="showSection('profile')">üë§ –ü—Ä–æ—Ñ–∏–ª—å</div>
        </div>

        <!-- –°–ï–ö–¶–ò–Ø –ò–ì–†–´ -->
        <div id="game-section" class="section active">
            <!-- –°–ß–ï–¢–ß–ò–ö –†–ï–ê–õ–¨–ù–´–• –ò–ì–†–û–ö–û–í -->
            <div class="player-counter">
                <div>üë• –†–µ–∞–ª—å–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤: <span id="real-players-count">1</span>/100</div>
                <div class="counter-progress">
                    <div class="counter-fill" id="counter-fill" style="width: 1%"></div>
                </div>
                <div style="font-size: 12px; opacity: 0.8;">–í—ã –ø–µ—Ä–≤—ã–π –∏–≥—Ä–æ–∫! –ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ –¥—Ä—É–∑–µ–π –¥–ª—è —Ä–æ—Å—Ç–∞ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞!</div>
            </div>

            <!-- –•–µ–¥–µ—Ä —Å —É—Ä–æ–≤–Ω–µ–º -->
            <div class="header">
                <div class="combo-display" id="combo-display">–ö–æ–º–±–æ: 0x</div>
                <div class="player-info">
                    <div class="player-rank" id="player-rank">ü•â –ë–†–û–ù–ó–ê</div>
                    <div>üíé <span id="coins">0</span></div>
                </div>
                <div class="level-info">
                    <span>‚≠ê –£—Ä–æ–≤–µ–Ω—å <span id="level">1</span></span>
                    <span id="rank-progress">0/1000</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="level-progress" style="width: 0%"></div>
                </div>
            </div>
            
            <!-- TON-–ü–ï–†–°–û–ù–ê–ñ -->
            <div class="character-container">
                <div class="ton-character character-level-1" id="ton-character">
                    <div class="character-body">
                        <div class="character-face">üíé</div>
                    </div>
                    <div class="character-glow"></div>
                </div>
            </div>
            
            <!-- –°–¢–ê–¢–ò–°–¢–ò–ö–ê -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div>‚ö° –°–∏–ª–∞ —Ç–∞–ø–∞</div>
                    <div class="stat-value" id="tap-power">1</div>
                </div>
                <div class="stat-card">
                    <div>üëÜ –í—Å–µ–≥–æ —Ç–∞–ø–æ–≤</div>
                    <div class="stat-value" id="total-taps">0</div>
                </div>
                <div class="stat-card">
                    <div>ü§ñ –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä—ã</div>
                    <div class="stat-value" id="auto-clickers">0</div>
                </div>
                <div class="stat-card">
                    <div>üí∞ –í —Å–µ–∫—É–Ω–¥—É</div>
                    <div class="stat-value" id="income-per-second">0</div>
                </div>
            </div>

            <!-- –£–ª—É—á—à–µ–Ω–∏—è -->
            <div class="upgrades-section">
                <h3 style="margin-bottom: 15px; text-align: center;">üõ† –£–ª—É—á—à–µ–Ω–∏—è</h3>
                <div class="upgrade-item">
                    <div class="upgrade-info">
                        <div class="upgrade-name">üí™ –£—Å–∏–ª–∏—Ç–µ–ª—å —Ç–∞–ø–∞</div>
                        <div class="upgrade-desc">+1 –∫ —Å–∏–ª–µ –∑–∞ –∫–ª–∏–∫</div>
                    </div>
                    <button class="upgrade-btn" id="upgrade-tap" data-cost="50">50 üíé</button>
                </div>
                <div class="upgrade-item">
                    <div class="upgrade-info">
                        <div class="upgrade-name">‚ö° –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä</div>
                        <div class="upgrade-desc">+1 –º–æ–Ω–µ—Ç–∞ –≤ —Å–µ–∫—É–Ω–¥—É</div>
                    </div>
                    <button class="upgrade-btn" id="upgrade-auto" data-cost="100">100 üíé</button>
                </div>
                <div class="upgrade-item">
                    <div class="upgrade-info">
                        <div class="upgrade-name">üéØ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É–¥–∞—Ä</div>
                        <div class="upgrade-desc">–®–∞–Ω—Å x3 —É—Ä–æ–Ω–∞</div>
                    </div>
                    <button class="upgrade-btn" id="upgrade-crit" data-cost="200">200 üíé</button>
                </div>
            </div>

            <!-- –°–ò–°–¢–ï–ú–ê –ü–†–ò–ì–õ–ê–®–ï–ù–ò–ô -->
            <div class="referral-section">
                <h3 style="margin-bottom: 15px;">üë• –ü—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–∑–µ–π</h3>
                <div class="referral-stats">
                    <div class="referral-stat">
                        <div>–ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ</div>
                        <div class="referral-count" id="referrals-count">0</div>
                    </div>
                    <div class="referral-stat">
                        <div>–ë–æ–Ω—É—Å–æ–≤</div>
                        <div class="referral-count" id="referrals-bonus">0</div>
                    </div>
                </div>
                <button onclick="inviteFriends()" style="background: rgba(255,255,255,0.9); color: #4CAF50; border: none; padding: 12px 24px; border-radius: 12px; cursor: pointer; font-weight: bold; width: 100%;">
                    üì§ –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å —á–µ—Ä–µ–∑ Telegram
                </button>
                <div style="font-size: 12px; margin-top: 10px;">
                    üéÅ +100 –º–æ–Ω–µ—Ç –∑–∞ –¥—Ä—É–≥–∞ + 10% –æ—Ç –µ–≥–æ –¥–æ—Ö–æ–¥–∞!
                </div>
            </div>

            <!-- –ë–ï–¢–ê-–£–í–ï–î–û–ú–õ–ï–ù–ò–ï -->
            <div class="beta-notice">
                <strong>üéÆ –ë–ï–¢–ê-–í–ï–†–°–ò–Ø</strong><br>
                –í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞ —ç—Ç–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.<br>
                –°–∫–æ—Ä–æ: –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥ –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è!
            </div>
        </div>

        <!-- –°–ï–ö–¶–ò–Ø –õ–ò–î–ï–†–ë–û–†–î–ê -->
        <div id="leaderboard-section" class="section">
            <div class="leaderboard-container">
                <h3 style="text-align: center; margin-bottom: 15px;">üèÜ –¢–û–ü-50 –ò–ì–†–û–ö–û–í</h3>
                <div id="leaderboard-list">
                    <!-- –õ–∏–¥–µ—Ä–±–æ—Ä–¥ –±—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
        </div>

        <!-- –°–ï–ö–¶–ò–Ø –ü–†–û–§–ò–õ–Ø -->
        <div id="profile-section" class="section">
            <div class="profile-container">
                <div class="profile-header">
                    <h3 id="profile-name">üë§ –ò–≥—Ä–æ–∫</h3>
                    <div class="player-rank" id="profile-rank">ü•â –ë–†–û–ù–ó–ê</div>
                </div>
                
                <div class="profile-stats">
                    <div class="profile-stat">
                        <div>üëÜ –í—Å–µ–≥–æ —Ç–∞–ø–æ–≤</div>
                        <div class="stat-value" id="profile-taps">0</div>
                    </div>
                    <div class="profile-stat">
                        <div>‚≠ê –£—Ä–æ–≤–µ–Ω—å</div>
                        <div class="stat-value" id="profile-level">1</div>
                    </div>
                    <div class="profile-stat">
                        <div>‚ö° –°–∏–ª–∞ —Ç–∞–ø–∞</div>
                        <div class="stat-value" id="profile-power">1</div>
                    </div>
                    <div class="profile-stat">
                        <div>ü§ñ –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä—ã</div>
                        <div class="stat-value" id="profile-autoclickers">0</div>
                    </div>
                    <div class="profile-stat">
                        <div>üéØ –ö—Ä–∏—Ç. —à–∞–Ω—Å</div>
                        <div class="stat-value" id="profile-crit">0%</div>
                    </div>
                    <div class="profile-stat">
                        <div>üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</div>
                        <div class="stat-value" id="profile-achievements">0</div>
                    </div>
                </div>

                <div class="beta-notice">
                    <strong>üíé –°–¢–ê–¢–£–° –û–°–ù–û–í–ê–¢–ï–õ–Ø</strong><br>
                    –í—ã —Å—Ä–µ–¥–∏ –ø–µ—Ä–≤—ã—Ö –∏–≥—Ä–æ–∫–æ–≤ TON Tap Empire!<br>
                    –í–∞—à–µ –∏–º—è –≤–æ–π–¥–µ—Ç –≤ –∏—Å—Ç–æ—Ä–∏—é –∏–≥—Ä—ã!
                </div>
            </div>
        </div>
    </div>

    <script>
        // –°–ò–°–¢–ï–ú–ê –†–ê–ù–ì–û–í
        const rankSystem = {
            BRONZE: { 
                minScore: 0, 
                color: "#CD7F32", 
                badge: "ü•â",
                name: "–ë–†–û–ù–ó–ê",
                class: "rank-bronze",
                badgeClass: "badge-bronze"
            },
            SILVER: { 
                minScore: 1000, 
                color: "#C0C0C0", 
                badge: "ü•à", 
                name: "–°–ï–†–ï–ë–†–û",
                class: "rank-silver", 
                badgeClass: "badge-silver"
            },
            GOLD: { 
                minScore: 5000, 
                color: "#FFD700", 
                badge: "ü•á", 
                name: "–ó–û–õ–û–¢–û",
                class: "rank-gold",
                badgeClass: "badge-gold"
            },
            PLATINUM: { 
                minScore: 20000, 
                color: "#E5E4E2", 
                badge: "üí†", 
                name: "–ü–õ–ê–¢–ò–ù–ê",
                class: "rank-platinum",
                badgeClass: "badge-platinum"
            },
            DIAMOND: { 
                minScore: 50000, 
                color: "#B9F2FF", 
                badge: "üíé", 
                name: "–ê–õ–ú–ê–ó",
                class: "rank-diamond",
                badgeClass: "badge-diamond"
            }
        };

        // –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let coins = 0;
        let tapPower = 1;
        let totalTaps = 0;
        let passiveIncome = 0;
        let level = 1;
        let levelProgress = 0;
        let autoClickers = 0;
        let critChance = 0;
        let currentRank = 'BRONZE';
        let lastPassiveIncomeTime = Date.now();
        
        // –ù–û–í–´–ï –°–ò–°–¢–ï–ú–´
        let combo = 0;
        let comboTimeout;
        let lastTapTime = 0;
        let referrals = 0;
        let referralBonus = 0;
        let realPlayersCount = 1;
        let eventCooldown = 0;

        // –õ–ò–î–ï–†–ë–û–†–î (–ª–æ–∫–∞–ª—å–Ω—ã–π –¥–µ–º–æ)
        let leaderboard = [];
        const MAX_LEADERBOARD_SIZE = 50;

        // –°–õ–£–ß–ê–ô–ù–´–ï –ò–í–ï–ù–¢–´
        const randomEvents = [
            {
                name: "üí∞ –ó–æ–ª–æ—Ç–æ–π –¥–æ–∂–¥—å",
                description: "–í—Å–µ —Ç–∞–ø—ã –¥–∞—é—Ç x3 –º–æ–Ω–µ—Ç—ã –Ω–∞ 30 —Å–µ–∫—É–Ω–¥!",
                chance: 0.02,
                effect: function() {
                    const oldPower = tapPower;
                    tapPower *= 3;
                    showEventNotification(this.name, this.description);
                    setTimeout(() => {
                        tapPower = oldPower;
                        showNotification("‚ö° –ó–æ–ª–æ—Ç–æ–π –¥–æ–∂–¥—å –∑–∞–∫–æ–Ω—á–∏–ª—Å—è");
                    }, 30000);
                }
            },
            {
                name: "üé∞ –°—á–∞—Å—Ç–ª–∏–≤—ã–π —Ç–∞–ø", 
                description: "–°–ª—É—á–∞–π–Ω—ã–π –±–æ–Ω—É—Å –æ—Ç x2 –¥–æ x10!",
                chance: 0.03,
                effect: function() {
                    const multiplier = Math.floor(Math.random() * 9) + 2;
                    const bonus = tapPower * multiplier;
                    coins += bonus;
                    showEventNotification(this.name, `–¢—ã –ø–æ–ª—É—á–∏–ª ${multiplier}x –±–æ–Ω—É—Å: +${bonus} –º–æ–Ω–µ—Ç!`);
                }
            },
            {
                name: "ü§ñ –ó–∞–≤–æ–¥ –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä–æ–≤",
                description: "–¢–≤–æ–∏ –∞–≤—Ç–æ–∫–ª–∏–∫–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç –≤ 2 —Ä–∞–∑–∞ –±—ã—Å—Ç—Ä–µ–µ 1 –º–∏–Ω—É—Ç—É!",
                chance: 0.015,
                effect: function() {
                    passiveIncome *= 2;
                    showEventNotification(this.name, this.description);
                    setTimeout(() => {
                        passiveIncome /= 2;
                        showNotification("‚öôÔ∏è –ó–∞–≤–æ–¥ –∑–∞–∫—Ä—ã–ª—Å—è");
                    }, 60000);
                }
            }
        ];

        // –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
        const achievements = {
            100: { claimed: false, reward: 50 },
            500: { claimed: false, reward: 200 },
            1000: { claimed: false, reward: 500 },
            combo: { claimed: false, reward: 300 }
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram
        let tg = window.Telegram.WebApp;
        
        function initGame() {
            tg.expand();
            tg.ready();
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
            const user = tg.initDataUnsafe.user;
            if (user) {
                loadProgress(user.id);
                initializeLeaderboard(user.id, user.first_name || '–ò–≥—Ä–æ–∫');
                checkReferral();
            } else {
                initializeLeaderboard('demo_user', '–î–µ–º–æ-–ò–≥—Ä–æ–∫');
            }
            
            setupEventListeners();
            startPassiveIncome();
            startCharacterAnimation();
            updateUI();
            updateRank();
            updateRealPlayersCounter();
            
            // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–∞ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            setInterval(() => {
                if (document.getElementById('leaderboard-section').classList.contains('active')) {
                    updateLeaderboard();
                }
            }, 30000);
        }
        
        function setupEventListeners() {
            // –û—Å–Ω–æ–≤–Ω–æ–π —Ç–∞–ø –ø–æ –ø–µ—Ä—Å–æ–Ω–∞–∂—É
            document.getElementById('ton-character').addEventListener('click', handleTap);
            
            // –£–ª—É—á—à–µ–Ω–∏—è
            document.getElementById('upgrade-tap').addEventListener('click', () => buyUpgrade('tap'));
            document.getElementById('upgrade-auto').addEventListener('click', () => buyUpgrade('auto'));
            document.getElementById('upgrade-crit').addEventListener('click', () => buyUpgrade('crit'));
        }

        function handleTap(event) {
            const now = Date.now();
            
            // –ö–û–ú–ë–û-–°–ò–°–¢–ï–ú–ê
            if (now - lastTapTime < 2000) {
                combo++;
                clearTimeout(comboTimeout);
            } else {
                combo = 1;
            }
            
            comboTimeout = setTimeout(() => {
                if (combo >= 10 && !achievements.combo.claimed) {
                    achievements.combo.claimed = true;
                    coins += achievements.combo.reward;
                    showNotification(`üéØ –ö–æ–º–±–æ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ! +${achievements.combo.reward} –º–æ–Ω–µ—Ç!`);
                }
                combo = 0;
                updateComboDisplay();
            }, 2000);
            
            lastTapTime = now;
            updateComboDisplay();
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
            animateCharacter();
            
            // –†–∞—Å—á–µ—Ç —É—Ä–æ–Ω–∞ —Å –∫—Ä–∏—Ç–∞–º–∏
            let earned = tapPower;
            let isCritical = false;
            let isComboBonus = false;
            
            // –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —É–¥–∞—Ä
            if (Math.random() < critChance) {
                earned *= 3;
                isCritical = true;
            }
            
            // –ë–æ–Ω—É—Å –∫–æ–º–±–æ (–ø–æ—Å–ª–µ 5 —Ç–∞–ø–æ–≤ –ø–æ–¥—Ä—è–¥)
            if (combo >= 5) {
                earned += Math.floor(combo / 5);
                isComboBonus = true;
            }
            
            // –°–õ–£–ß–ê–ô–ù–´–ï –ò–í–ï–ù–¢–´
            if (eventCooldown <= 0) {
                randomEvents.forEach(event => {
                    if (Math.random() < event.chance) {
                        event.effect();
                        eventCooldown = 60;
                    }
                });
            } else {
                eventCooldown--;
            }
            
            coins += earned;
            totalTaps++;
            levelProgress += earned;
            
            // –°–æ–∑–¥–∞–µ–º —ç—Ñ—Ñ–µ–∫—Ç
            createTapEffect(event, earned, isCritical, isComboBonus);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
            checkAchievements();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Ä–æ–≤–µ–Ω—å
            checkLevelUp();
            
            updateUI();
            updateRank();
            updateLeaderboard();
            saveProgress();
        }
        
        function animateCharacter() {
            const character = document.getElementById('ton-character');
            character.style.transform = 'scale(0.95)';
            setTimeout(() => {
                character.style.transform = 'scale(1)';
            }, 100);
        }
        
        function startCharacterAnimation() {
            setInterval(() => {
                const character = document.getElementById('ton-character');
                character.style.transform = 'scale(1.05)';
                setTimeout(() => {
                    character.style.transform = 'scale(1)';
                }, 500);
            }, 5000);
        }

        function updateCharacterAppearance() {
            const character = document.getElementById('ton-character');
            character.className = 'ton-character';
            
            if (level >= 30) {
                character.classList.add('character-level-30');
            } else if (level >= 20) {
                character.classList.add('character-level-20');
            } else if (level >= 10) {
                character.classList.add('character-level-10');
            } else {
                character.classList.add('character-level-1');
            }
        }
        
        function createTapEffect(event, amount, isCritical = false, isComboBonus = false) {
            const effect = document.createElement('div');
            effect.className = 'tap-effect';
            
            if (isCritical) {
                effect.className += ' critical';
                effect.textContent = 'CRIT! +' + amount;
            } else if (isComboBonus) {
                effect.className += ' combo';
                effect.textContent = 'COMBO +' + amount;
            } else {
                effect.className += ' normal';
                effect.textContent = '+' + amount;
            }
            
            effect.style.left = (event.clientX - 20) + 'px';
            effect.style.top = (event.clientY - 20) + 'px';
            document.querySelector('.character-container').appendChild(effect);
            
            setTimeout(() => effect.remove(), 1000);
        }
        
        function updateComboDisplay() {
            const comboDisplay = document.getElementById('combo-display');
            if (combo >= 3) {
                comboDisplay.style.display = 'block';
                comboDisplay.textContent = `–ö–æ–º–±–æ: ${combo}x`;
                comboDisplay.style.background = combo >= 10 ? 
                    'linear-gradient(135deg, #ff0000, #ff6b6b)' :
                    'linear-gradient(135deg, #ff6b6b, #ffd93d)';
            } else {
                comboDisplay.style.display = 'none';
            }
        }

        // –°–ò–°–¢–ï–ú–ê –ü–†–ò–ì–õ–ê–®–ï–ù–ò–ô
        function checkReferral() {
            const urlParams = new URLSearchParams(window.location.search);
            const ref = urlParams.get('ref');
            if (ref) {
                // –ò–≥—Ä–æ–∫ –ø–µ—Ä–µ—à–µ–ª –ø–æ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ
                const referrerId = ref;
                rewardReferral(referrerId);
            }
        }

        function rewardReferral(referrerId) {
            // –í —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–µ—Ä—É
            showNotification("üéâ –í—ã –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª–∏—Å—å –ø–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—é –¥—Ä—É–≥–∞! +500 –º–æ–Ω–µ—Ç!");
            coins += 500;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–µ—Ñ–µ—Ä–∞–ª–µ
            const referrals = JSON.parse(localStorage.getItem('ton_tap_referrals') || '[]');
            referrals.push({
                referrer: referrerId,
                referred: tg.initDataUnsafe.user.id,
                date: new Date().toISOString()
            });
            localStorage.setItem('ton_tap_referrals', JSON.stringify(referrals));
            
            updateRealPlayersCounter();
        }

        function inviteFriends() {
            const user = tg.initDataUnsafe.user;
            if (!user) return;

            const refLink = `https://t.me/my_game_test_123_bot?start=ref_${user.id}`;
            const shareText = `üéÆ –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ TON Tap Empire! \n\n–ó–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π –º–æ–Ω–µ—Ç—ã, –ø—Ä–æ–∫–∞—á–∏–≤–∞–π TON-–ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –∏ —Å–æ—Ä–µ–≤–Ω—É–π—Å—è —Å –¥—Ä—É–∑—å—è–º–∏! \n\n–ù–∞—á–Ω–∏ –∏–≥—Ä–∞—Ç—å: ${refLink}`;
            
            if (tg.share) {
                tg.share(shareText);
            } else {
                navigator.clipboard.writeText(shareText).then(() => {
                    showNotification("üìã –°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞! –û—Ç–ø—Ä–∞–≤—å –¥—Ä—É–≥—É –≤ Telegram");
                });
            }
        }

        // –°–ß–ï–¢–ß–ò–ö –†–ï–ê–õ–¨–ù–´–• –ò–ì–†–û–ö–û–í
        function updateRealPlayersCounter() {
            // –ü–†–ê–í–î–ê: –ø–æ–∫–∞ —Ç–æ–ª—å–∫–æ –≤—ã –æ–¥–∏–Ω —Ä–µ–∞–ª—å–Ω—ã–π –∏–≥—Ä–æ–∫
            realPlayersCount = 1;
            
            document.getElementById('real-players-count').textContent = realPlayersCount;
            document.getElementById('counter-fill').style.width = realPlayersCount + '%';
            
            // –ß–µ—Å—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            if (realPlayersCount === 1) {
                document.querySelector('.player-counter div:last-child').textContent = 
                    "–í—ã –ø–µ—Ä–≤—ã–π –∏–≥—Ä–æ–∫! –ü—Ä–∏–≥–ª–∞—Å–∏—Ç–µ –¥—Ä—É–∑–µ–π –¥–ª—è —Ä–æ—Å—Ç–∞ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞!";
            }
        }

        // –û–ü–û–í–ï–©–ï–ù–ò–Ø
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        function showEventNotification(title, description) {
            document.getElementById('event-title').textContent = title;
            document.getElementById('event-description').textContent = description;
            document.getElementById('event-notification').style.display = 'block';
        }

        function closeEvent() {
            document.getElementById('event-notification').style.display = 'none';
        }

        // –°–ò–°–¢–ï–ú–ê –†–ê–ù–ì–û–í
        function calculateRankScore() {
            return totalTaps + (level * 100) + (autoClickers * 50) + (tapPower * 10) + (critChance * 1000);
        }

        function updateRank() {
            const score = calculateRankScore();
            let newRank = 'BRONZE';
            
            for (const [rank, data] of Object.entries(rankSystem)) {
                if (score >= data.minScore) {
                    newRank = rank;
                }
            }
            
            if (newRank !== currentRank) {
                currentRank = newRank;
            }
            
            const rankData = rankSystem[currentRank];
            const rankElement = document.getElementById('player-rank');
            rankElement.innerHTML = `${rankData.badge} <span class="${rankData.class}">${rankData.name}</span>`;
            
            const nextRank = getNextRank(currentRank);
            if (nextRank) {
                const progress = ((score - rankData.minScore) / (nextRank.minScore - rankData.minScore)) * 100;
                document.getElementById('rank-progress').textContent = 
                    `${score - rankData.minScore}/${nextRank.minScore - rankData.minScore}`;
            } else {
                document.getElementById('rank-progress').textContent = '–ú–ê–ö–°–ò–ú–£–ú';
            }
        }

        function getNextRank(currentRank) {
            const ranks = Object.keys(rankSystem);
            const currentIndex = ranks.indexOf(currentRank);
            return currentIndex < ranks.length - 1 ? rankSystem[ranks[currentIndex + 1]] : null;
        }

        function buyUpgrade(type) {
            const button = document.getElementById(`upgrade-${type}`);
            const cost = parseInt(button.dataset.cost);
            
            if (coins >= cost) {
                coins -= cost;
                
                switch(type) {
                    case 'tap':
                        tapPower += 1;
                        button.dataset.cost = Math.floor(cost * 1.5);
                        button.textContent = Math.floor(cost * 1.5) + ' üíé';
                        showNotification('üí™ –°–∏–ª–∞ —Ç–∞–ø–∞ —É–≤–µ–ª–∏—á–µ–Ω–∞!');
                        break;
                    case 'auto':
                        passiveIncome += 1;
                        autoClickers += 1;
                        button.dataset.cost = Math.floor(cost * 2);
                        button.textContent = Math.floor(cost * 2) + ' üíé';
                        showNotification('ü§ñ –ê–≤—Ç–æ–∫–ª–∏–∫–µ—Ä –¥–æ–±–∞–≤–ª–µ–Ω! +1/—Å–µ–∫');
                        break;
                    case 'crit':
                        critChance += 0.05;
                        button.dataset.cost = Math.floor(cost * 3);
                        button.textContent = Math.floor(cost * 3) + ' üíé';
                        showNotification('üéØ –®–∞–Ω—Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–≥–æ —É–¥–∞—Ä–∞ —É–≤–µ–ª–∏—á–µ–Ω!');
                        break;
                }
                
                updateUI();
                updateRank();
                saveProgress();
            } else {
                showNotification('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
            }
        }

        function checkAchievements() {
            Object.keys(achievements).forEach(key => {
                if (key === 'combo') return;
                
                const achievement = achievements[key];
                if (!achievement.claimed && totalTaps >= parseInt(key)) {
                    achievement.claimed = true;
                    coins += achievement.reward;
                    showNotification(`üéâ –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ ${key} —Ç–∞–ø–æ–≤! +${achievement.reward} –º–æ–Ω–µ—Ç!`);
                }
            });
        }

        function checkLevelUp() {
            const needed = level * 100;
            if (levelProgress >= needed) {
                level++;
                levelProgress = 0;
                tapPower += Math.floor(level / 2);
                
                updateCharacterAppearance();
                showNotification(`üéä –£—Ä–æ–≤–µ–Ω—å ${level}! –°–∏–ª–∞ +${Math.floor(level / 2)}!`);
                
                if (level % 5 === 0) {
                    const bonus = level * 10;
                    coins += bonus;
                    showNotification(`üèÜ –Æ–±–∏–ª–µ–π–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å! –ë–æ–Ω—É—Å: +${bonus} –º–æ–Ω–µ—Ç!`);
                }
            }
            
            const progressPercent = (levelProgress / (level * 100)) * 100;
            document.getElementById('level-progress').style.width = progressPercent + '%';
        }

        // –õ–ò–î–ï–†–ë–û–†–î - –î–ò–ù–ê–ú–ò–ß–ï–°–ö–ê–Ø –í–ï–†–°–ò–Ø
        function initializeLeaderboard(userId, userName) {
            const savedLeaderboard = localStorage.getItem('ton_tap_leaderboard');
            if (savedLeaderboard) {
                leaderboard = JSON.parse(savedLeaderboard);
            } else {
                leaderboard = generateDemoLeaderboard();
                leaderboard.push({
                    id: userId,
                    name: userName,
                    score: calculateRankScore(),
                    rank: currentRank,
                    lastActive: new Date(),
                    isOnline: true,
                    tapsPerSecond: 1
                });
                updateLeaderboard();
            }
        }

        function generateDemoLeaderboard() {
            const demoPlayers = [];
            const names = ['Alex_TON', 'Crypto_Maria', 'John_Coin', 'Anna_Crypto', 'Mike_Block', 
                           'Sarah_Chain', 'David_NFT', 'Emma_Wallet', 'James_Miner', 'Lisa_DeFi',
                           'Max_Investor', 'Kate_Trader', 'Tom_Hodler', 'Luna_Moon', 'Sam_Satoshi',
                           'Ruby_Gem', 'Leo_Diamond', 'Oscar_Gold', 'Eva_Silver', 'Noah_Platinum'];
            
            const currentTime = Date.now();
            
            for (let i = 0; i < 49; i++) {
                const name = names[i % names.length] + getRandomEmoji();
                
                const baseScore = 10000 + Math.floor(Math.random() * 90000);
                const timeFactor = Math.sin(currentTime / 1000000 + i) * 5000;
                const activityFactor = Math.random() * 2000;
                const score = Math.max(1000, baseScore + timeFactor + activityFactor);
                
                let rank = 'BRONZE';
                for (const [r, data] of Object.entries(rankSystem)) {
                    if (score >= data.minScore) {
                        rank = r;
                    }
                }
                
                const lastActive = new Date(currentTime - Math.random() * 7 * 24 * 60 * 60 * 1000);
                
                demoPlayers.push({
                    id: 'demo_' + i,
                    name: name,
                    score: Math.floor(score),
                    rank: rank,
                    lastActive: lastActive,
                    isOnline: Math.random() > 0.7,
                    tapsPerSecond: 1 + Math.random() * 10
                });
            }
            
            return demoPlayers.sort((a, b) => b.score - a.score).slice(0, MAX_LEADERBOARD_SIZE - 1);
        }

        function getRandomEmoji() {
            const emojis = [' üíé', ' üöÄ', ' ‚≠ê', ' üî•', ' üí∞', ' üèÜ', ' üåü', ' ‚ú®', ' ‚ö°', ' üéØ'];
            return emojis[Math.floor(Math.random() * emojis.length)];
        }

        function renderLeaderboard() {
            const list = document.getElementById('leaderboard-list');
            list.innerHTML = '';
            
            updateBotActivity();
            
            leaderboard.forEach((player, index) => {
                const rankData = rankSystem[player.rank] || rankSystem.BRONZE;
                const isUser = tg.initDataUnsafe.user && player.id === tg.initDataUnsafe.user.id;
                
                const item = document.createElement('div');
                item.className = `leaderboard-item ${index < 3 ? 'rank-' + (index + 1) : ''} ${isUser ? 'user-highlight' : ''}`;
                
                const timeAgo = getTimeAgo(player.lastActive);
                
                item.innerHTML = `
                    <div class="leaderboard-rank">
                        ${index + 1}
                        ${player.isOnline ? '<span style="color: #4CAF50; font-size: 8px;">‚óè</span>' : ''}
                    </div>
                    <div class="leaderboard-player">
                        <div>
                            <span class="${rankData.class}">${player.name}</span>
                            ${isUser ? '<span style="color: #ffd93d; margin-left: 5px;">(–í—ã)</span>' : ''}
                        </div>
                        <div style="font-size: 10px; opacity: 0.7;">
                            ${player.isOnline ? 'üü¢ –û–Ω–ª–∞–π–Ω' : `‚è±Ô∏è –ë—ã–ª ${timeAgo}`}
                            ‚Ä¢ ${player.tapsPerSecond.toFixed(1)}/—Å–µ–∫
                        </div>
                    </div>
                    <div class="leaderboard-score">${player.score.toLocaleString()}</div>
                `;
                list.appendChild(item);
            });
        }

        function updateBotActivity() {
            const now = new Date();
            leaderboard.forEach(player => {
                if (player.id.startsWith('demo_')) {
                    if (Math.random() > 0.95) {
                        player.isOnline = !player.isOnline;
                    }
                    
                    if (player.isOnline && Math.random() > 0.7) {
                        player.score += Math.floor(player.tapsPerSecond * (1 + Math.random()));
                        player.lastActive = new Date();
                        
                        for (const [rank, data] of Object.entries(rankSystem)) {
                            if (player.score >= data.minScore) {
                                player.rank = rank;
                            }
                        }
                    }
                }
            });
            
            leaderboard.sort((a, b) => b.score - a.score);
        }

        function getTimeAgo(date) {
            const now = new Date();
            const diff = now - date;
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(diff / 3600000);
            const days = Math.floor(diff / 86400000);
            
            if (minutes < 1) return '—Ç–æ–ª—å–∫–æ —á—Ç–æ';
            if (minutes < 60) return `${minutes} –º–∏–Ω –Ω–∞–∑–∞–¥`;
            if (hours < 24) return `${hours} —á –Ω–∞–∑–∞–¥`;
            return `${days} –¥ –Ω–∞–∑–∞–¥`;
        }

        function updateLeaderboard() {
            const user = tg.initDataUnsafe.user;
            if (!user) return;

            const userScore = calculateRankScore();
            const userIndex = leaderboard.findIndex(p => p.id === user.id);
            
            if (userIndex !== -1) {
                leaderboard[userIndex].score = userScore;
                leaderboard[userIndex].rank = currentRank;
                leaderboard[userIndex].lastActive = new Date();
                leaderboard[userIndex].isOnline = true;
            } else {
                leaderboard.push({
                    id: user.id,
                    name: user.first_name || '–ò–≥—Ä–æ–∫',
                    score: userScore,
                    rank: currentRank,
                    lastActive: new Date(),
                    isOnline: true,
                    tapsPerSecond: tapPower
                });
            }
            
            leaderboard.sort((a, b) => b.score - a.score);
            leaderboard = leaderboard.slice(0, MAX_LEADERBOARD_SIZE);
            
            localStorage.setItem('ton_tap_leaderboard', JSON.stringify(leaderboard));
            renderLeaderboard();
        }

        // –ü–ê–°–°–ò–í–ù–´–ô –î–û–•–û–î
        function startPassiveIncome() {
            setInterval(() => {
                if (passiveIncome > 0) {
                    const now = Date.now();
                    const timePassed = (now - lastPassiveIncomeTime) / 1000;
                    
                    if (timePassed >= 1) {
                        const income = passiveIncome;
                        coins += income;
                        lastPassiveIncomeTime = now;
                        
                        showPassiveIncomeEffect(income);
                        updateUI();
                        updateLeaderboard();
                        saveProgress();
                    }
                }
            }, 100);
        }
        
        function showPassiveIncomeEffect(amount) {
            const effect = document.createElement('div');
            effect.className = 'passive-income-effect';
            effect.textContent = `ü§ñ +${amount}`;
            document.body.appendChild(effect);
            
            setTimeout(() => {
                effect.remove();
            }, 2000);
        }

        // –ù–ê–í–ò–ì–ê–¶–ò–Ø
        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(sectionName + '-section').classList.add('active');
            event.target.classList.add('active');
            
            if (sectionName === 'profile') {
                updateProfile();
            } else if (sectionName === 'leaderboard') {
                renderLeaderboard();
            }
        }

        function updateProfile() {
            const user = tg.initDataUnsafe.user;
            if (user) {
                document.getElementById('profile-name').textContent = `üë§ ${user.first_name || '–ò–≥—Ä–æ–∫'}`;
            }
            
            const rankData = rankSystem[currentRank];
            document.getElementById('profile-rank').innerHTML = 
                `${rankData.badge} <span class="${rankData.class}">${rankData.name}</span>`;
            
            document.getElementById('profile-taps').textContent = totalTaps.toLocaleString();
            document.getElementById('profile-level').textContent = level;
            document.getElementById('profile-power').textContent = tapPower;
            document.getElementById('profile-autoclickers').textContent = autoClickers;
            document.getElementById('profile-crit').textContent = Math.round(critChance * 100) + '%';
        }
        
        function updateUI() {
            document.getElementById('coins').textContent = coins;
            document.getElementById('tap-power').textContent = tapPower;
            document.getElementById('total-taps').textContent = totalTaps.toLocaleString();
            document.getElementById('auto-clickers').textContent = autoClickers;
            document.getElementById('income-per-second').textContent = passiveIncome;
            document.getElementById('level').textContent = level;
            
            updateUpgradeButtons();
        }
        
        function updateUpgradeButtons() {
            const upgrades = ['tap', 'auto', 'crit'];
            upgrades.forEach(type => {
                const button = document.getElementById(`upgrade-${type}`);
                const cost = parseInt(button.dataset.cost);
                button.disabled = coins < cost;
            });
        }
        
        function loadProgress(userId) {
            try {
                const saved = localStorage.getItem(`ton_tap_player_${userId}`);
                if (saved) {
                    const data = JSON.parse(saved);
                    coins = data.coins || 0;
                    tapPower = data.tapPower || 1;
                    totalTaps = data.totalTaps || 0;
                    passiveIncome = data.passiveIncome || 0;
                    autoClickers = data.autoClickers || 0;
                    level = data.level || 1;
                    levelProgress = data.levelProgress || 0;
                    critChance = data.critChance || 0;
                }
            } catch (e) {
                console.error('Error loading progress:', e);
            }
        }
        
        function saveProgress() {
            try {
                const user = tg.initDataUnsafe.user;
                if (user) {
                    const data = {
                        coins,
                        tapPower,
                        totalTaps,
                        passiveIncome,
                        autoClickers,
                        level,
                        levelProgress,
                        critChance
                    };
                    localStorage.setItem(`ton_tap_player_${user.id}`, JSON.stringify(data));
                }
            } catch (e) {
                console.error('Error saving progress:', e);
            }
        }
        
        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
        document.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
